<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.15"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>My Project: 操作系统</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    extensions: ["tex2jax.js"],
    jax: ["input/TeX","output/HTML-CSS"],
});
</script><script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.2/MathJax.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">My Project
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.15 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">操作系统 </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p class="">这里对这个操作系统的各个模块做了具体的介绍。</p>
<p class="">[toc]</p>
<h2>总体情况</h2>
<table class="markdownTable">
<tr class="markdownTableHead">
<th class="markdownTableHeadNone">模块  </th><th class="markdownTableHeadNone" colspan="4">   </th></tr>
<tr class="markdownTableBody" class="markdownTableRowOdd">
<td class="markdownTableBodyNone">boot.bin  </td><td class="markdownTableBodyNone" colspan="2">(0,0,1):0,1  </td><td class="markdownTableBodyNone">0x7c00-0x7e00  </td><td class="markdownTableBodyNone">在软盘从指定位置加载loader.bin   </td></tr>
</table>
<p>|loader.bin|(1,1,10):63,5|0x8000-0xFFFF|在软盘中加载kernel.bin，并跳转到内核| |kernel.bin|(0,2,1):72,16||0x10000-0x2FFFF|在内核下，初始化各种东西后，自动加载tty| |tty.bin|(1,2,1):90,10||0x30000-0x34FFF|显示终端，调用各种功能| |fsystem.bin|(?,?,?):?,4|||在内存中，作为访问文件的接口| |user_stone_1.bin|126,5||0x4000:0x0000|一个用于测试的用户程序| |user_stone_2.bin|148,5||0x4000:0x0000|一个用于测试的用户程序| |user_stone_3.bin|166,5||0x4000:0x0000|一个用于测试的用户程序| |user_stone_4.bin|184,5||0x4000:0x0000|一个用于测试的用户程序|</p>
<h2>kernel.bin</h2>
<p class="">0x1000:0x0000</p>
<p class="">直接跳到tty</p>
<p class="">（讲道理应该是要调用文件系统，寻找tty.bin,然后加载进内存指定位置后再跳到tty）</p>
<h2>tty.bin</h2>
<h3>驱动机制</h3>
<p class="">tty使用事件驱动型机制，对键盘输入进行轮询，一旦有输入，进行处理，若无输入，不断循环。</p>
<ol type="1">
<li>更新显示内容</li>
</ol>
<ol type="1">
<li>判断键盘是否有输入</li>
</ol>
<ol type="1">
<li>读取当前键盘输入<ol type="a">
<li>当输入可打印字符时(通过<code>isprint</code>函数判断），修改显示缓冲区，更新开头索引。</li>
</ol>
<ol type="a">
<li>当enter时,将输入缓冲区内容打包送往parser，由parser执行对应指令</li>
</ol>
<ol type="a">
<li>回到循环开头“更新显示内容”</li>
</ol>
</li>
</ol>
<h3>需要维护的量</h3>
<p class="">主要维护以下量：</p>
<ol type="1">
<li>输入缓冲区，输入缓冲区与显示内容异步更新。</li>
</ol>
<h2>fsystem.bin</h2>
<p class="">我的想法是始终将这个放到内存的某一个区域（如0x1000-0x2FFF） 内存中有一块作为缓冲区 0x3000-0x4000</p>
<ol type="1">
<li>给寄存器传递一些参数，然后调用中断，通过某个寄存器索引到该项调用</li>
</ol>
<ol type="1">
<li>参数类型<ol type="a">
<li>file_name</li>
</ol>
<ol type="a">
<li>es:bx</li>
</ol>
</li>
</ol>
<ol type="1">
<li>根据参数的不同，提供以下功能<ol type="a">
<li>error_code load_com_file(file_name, ex:bx) {0 if normal，1 if not found, 2 if file_header corrupted}</li>
</ol>
<ol type="a">
<li>init_kernel()</li>
</ol>
</li>
</ol>
<ol type="1">
<li>有以下子过程<ol type="a">
<li>转换：逻辑扇区号-&gt;(磁头号，柱面号，扇区号)</li>
</ol>
<ol type="a">
<li>起始簇号 search_file(file_name) 加载跟目录区到缓冲区，在根目录区搜索条目，找到后，返回指定偏移量处的起始簇号</li>
</ol>
<ol type="a">
<li>void load_file(起始簇号，es:bx) {根据簇号，加载指定fat表所在扇区（若同一个扇区就不加载），加载指定簇，获取下一个簇，更新bx} loop</li>
</ol>
<ol type="a">
<li>TODO:删除文件，（在目录区删除指定条目）</li>
</ol>
<ol type="a">
<li>TODO:根据参数，将指定格式的文件加载</li>
</ol>
<ol type="a">
<li>TODO:分配空闲簇号，根据es:bx, length两个参数，将内存内容写到扇区中，并更新条目 </li>
</ol>
</li>
</ol>
</div></div><!-- PageDoc -->
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.15
</small></address>
</body>
</html>
