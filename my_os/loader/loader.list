     1                                  %include "../include/macro.inc"
     2                              <1> loader_code_segment equ 0x0800
     3                              <1> loader_code_entry equ 0x0000
     4                              <1> kernel_code_segment equ 0x1000
     5                              <1> kernel_code_entry equ 0x0000
     6                              <1> 
     7                              <1> 
     8                              <1> 
     9                              <1> 
    10                              <1> core_header_data_segment equ 0100h
    11                              <1> core_code_entry_header_offset equ 0x2A
    12                              <1> core_code_segment_header_offset equ 0x2C
    13                              <1> core_data_segment_header_offset equ 0x2E
    14                              <1> core_stack_segment_header_offset equ 0x30
    15                              <1> core_stack_length equ 256
    16                              <1> core_entry_header_offset equ 0x32
    17                              <1> user1_program_address equ 0x2000
    18                              <1> user2_program_address equ 0x3000
    19                              <1> user3_program_address equ 0x4000
    20                              <1> user4_program_address equ 0x5000
    21                              <1> 
    22                              <1> user1_bound_x_up equ 1 
    23                              <1> user1_bound_x_down equ 12
    24                              <1> user1_bound_y_left equ 1
    25                              <1> user1_bound_y_right equ 39 
    26                              <1> 
    27                              <1> user2_bound_x_up equ 1 
    28                              <1> user2_bound_x_down equ 12
    29                              <1> user2_bound_y_left equ 40
    30                              <1> user2_bound_y_right equ 78 
    31                              <1> 
    32                              <1> user3_bound_x_up equ 13 
    33                              <1> user3_bound_x_down equ 23
    34                              <1> user3_bound_y_left equ 1
    35                              <1> user3_bound_y_right equ 39
    36                              <1> 
    37                              <1> user4_bound_x_up equ 13 
    38                              <1> user4_bound_x_down equ 23
    39                              <1> user4_bound_y_left equ 40
    40                              <1> user4_bound_y_right equ 78 
    41                                  %include "../include/pm.inc"
    42                              <1> 
    43                              <1> 
    44                              <1> ; 描述符图示
    45                              <1> 
    46                              <1> ; 图示一
    47                              <1> ;
    48                              <1> ;  ------ ┏━━┳━━┓高地址
    49                              <1> ;         ┃ 7  ┃ 段 ┃
    50                              <1> ;         ┣━━┫    ┃
    51                              <1> ;                  基
    52                              <1> ;  字节 7 ┆    ┆    ┆
    53                              <1> ;                  址
    54                              <1> ;         ┣━━┫ ② ┃
    55                              <1> ;         ┃ 0  ┃    ┃
    56                              <1> ;  ------ ┣━━╋━━┫
    57                              <1> ;         ┃ 7  ┃ G  ┃
    58                              <1> ;         ┣━━╉──┨
    59                              <1> ;         ┃ 6  ┃ D  ┃
    60                              <1> ;         ┣━━╉──┨
    61                              <1> ;         ┃ 5  ┃ 0  ┃
    62                              <1> ;         ┣━━╉──┨
    63                              <1> ;         ┃ 4  ┃ AVL┃
    64                              <1> ;  字节 6 ┣━━╉──┨
    65                              <1> ;         ┃ 3  ┃    ┃
    66                              <1> ;         ┣━━┫ 段 ┃
    67                              <1> ;         ┃ 2  ┃ 界 ┃
    68                              <1> ;         ┣━━┫ 限 ┃
    69                              <1> ;         ┃ 1  ┃    ┃
    70                              <1> ;         ┣━━┫ ② ┃
    71                              <1> ;         ┃ 0  ┃    ┃
    72                              <1> ;  ------ ┣━━╋━━┫
    73                              <1> ;         ┃ 7  ┃ P  ┃
    74                              <1> ;         ┣━━╉──┨
    75                              <1> ;         ┃ 6  ┃    ┃
    76                              <1> ;         ┣━━┫ DPL┃
    77                              <1> ;         ┃ 5  ┃    ┃
    78                              <1> ;         ┣━━╉──┨
    79                              <1> ;         ┃ 4  ┃ S  ┃
    80                              <1> ;  字节 5 ┣━━╉──┨
    81                              <1> ;         ┃ 3  ┃    ┃
    82                              <1> ;         ┣━━┫ T  ┃
    83                              <1> ;         ┃ 2  ┃ Y  ┃
    84                              <1> ;         ┣━━┫ P  ┃
    85                              <1> ;         ┃ 1  ┃ E  ┃
    86                              <1> ;         ┣━━┫    ┃
    87                              <1> ;         ┃ 0  ┃    ┃
    88                              <1> ;  ------ ┣━━╋━━┫
    89                              <1> ;         ┃ 23 ┃    ┃
    90                              <1> ;         ┣━━┫    ┃
    91                              <1> ;         ┃ 22 ┃    ┃
    92                              <1> ;         ┣━━┫ 段 ┃
    93                              <1> ;
    94                              <1> ;   字节  ┆    ┆ 基 ┆
    95                              <1> ; 2, 3, 4
    96                              <1> ;         ┣━━┫ 址 ┃
    97                              <1> ;         ┃ 1  ┃ ① ┃
    98                              <1> ;         ┣━━┫    ┃
    99                              <1> ;         ┃ 0  ┃    ┃
   100                              <1> ;  ------ ┣━━╋━━┫
   101                              <1> ;         ┃ 15 ┃    ┃
   102                              <1> ;         ┣━━┫    ┃
   103                              <1> ;         ┃ 14 ┃    ┃
   104                              <1> ;         ┣━━┫ 段 ┃
   105                              <1> ;
   106                              <1> ; 字节 0,1┆    ┆ 界 ┆
   107                              <1> ;
   108                              <1> ;         ┣━━┫ 限 ┃
   109                              <1> ;         ┃ 1  ┃ ① ┃
   110                              <1> ;         ┣━━┫    ┃
   111                              <1> ;         ┃ 0  ┃    ┃
   112                              <1> ;  ------ ┗━━┻━━┛低地址
   113                              <1> ;
   114                              <1> 
   115                              <1> 
   116                              <1> ; 图示二
   117                              <1> 
   118                              <1> ; 高地址………………………………………………………………………低地址
   119                              <1> 
   120                              <1> ; |   7   |   6   |   5   |   4   |   3   |   2   |   1   |   0    |
   121                              <1> ; |7654321076543210765432107654321076543210765432107654321076543210|	<- 共 8 字节
   122                              <1> ; |--------========--------========--------========--------========|
   123                              <1> ; ┏━━━┳━━━━━━━┳━━━━━━━━━━━┳━━━━━━━┓
   124                              <1> ; ┃31..24┃   (见下图)   ┃     段基址(23..0)    ┃ 段界限(15..0)┃
   125                              <1> ; ┃      ┃              ┃                      ┃              ┃
   126                              <1> ; ┃ 基址2┃③│②│    ①┃基址1b│   基址1a     ┃    段界限1   ┃
   127                              <1> ; ┣━━━╋━━━┳━━━╋━━━━━━━━━━━╋━━━━━━━┫
   128                              <1> ; ┃   %6 ┃  %5  ┃  %4  ┃  %3  ┃     %2       ┃       %1     ┃
   129                              <1> ; ┗━━━┻━━━┻━━━┻━━━┻━━━━━━━┻━━━━━━━┛
   130                              <1> ;         │                \_________
   131                              <1> ;         │                          \__________________
   132                              <1> ;         │                                             \________________________________________________
   133                              <1> ;         │                                                                                              ;         ┏━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━
   134                              <1> ;         ┃ 7  ┃ 6  ┃ 5  ┃ 4  ┃ 3  ┃ 2  ┃ 1  ┃ 0  ┃ 7  ┃ 6  ┃ 5  ┃ 4  ┃ 3  ┃ 2  ┃ 1  ┃ 0  ┃
   135                              <1> ;         ┣━━╋━━╋━━╋━━╋━━┻━━┻━━┻━━╋━━╋━━┻━━╋━━╋━━┻━━┻━━┻━━┫
   136                              <1> ;         ┃ G  ┃D/B ┃ 0  ┃ AVL┃   段界限 2 (19..16)  ┃  P ┃   DPL    ┃ S  ┃       TYPE           ┃
   137                              <1> ;         ┣━━┻━━┻━━┻━━╋━━━━━━━━━━━╋━━┻━━━━━┻━━┻━━━━━━━━━━━┫
   138                              <1> ;         ┃      ③: 属性 2      ┃    ②: 段界限 2      ┃                   ①: 属性1                  ┃
   139                              <1> ;         ┗━━━━━━━━━━━┻━━━━━━━━━━━┻━━━━━━━━━━━━━━━━━━━━━━━┛
   140                              <1> ;       高地址                                                                                          低地址
   141                              <1> ;
   142                              <1> ;
   143                              <1> 
   144                              <1> ; 说明:
   145                              <1> ;
   146                              <1> ; (1) P:    存在(Present)位。
   147                              <1> ;		P=1 表示描述符对地址转换是有效的，或者说该描述符所描述的段存在，即在内存中；
   148                              <1> ;		P=0 表示描述符对地址转换无效，即该段不存在。使用该描述符进行内存访问时会引起异常。
   149                              <1> ;
   150                              <1> ; (2) DPL:  表示描述符特权级(Descriptor Privilege level)，共2位。它规定了所描述段的特权级，用于特权检查，以决定对该段能否访问。 
   151                              <1> ;
   152                              <1> ; (3) S:   说明描述符的类型。
   153                              <1> ;		对于存储段描述符而言，S=1，以区别与系统段描述符和门描述符(S=0)。 
   154                              <1> ;
   155                              <1> ; (4) TYPE: 说明存储段描述符所描述的存储段的具体属性。
   156                              <1> ;
   157                              <1> ;		 
   158                              <1> ;	数据段类型	类型值		说明
   159                              <1> ;			----------------------------------
   160                              <1> ;			0		只读 
   161                              <1> ;			1		只读、已访问 
   162                              <1> ;			2		读/写 
   163                              <1> ;			3		读/写、已访问 
   164                              <1> ;			4		只读、向下扩展 
   165                              <1> ;			5		只读、向下扩展、已访问 
   166                              <1> ;			6		读/写、向下扩展 
   167                              <1> ;			7		读/写、向下扩展、已访问 
   168                              <1> ;
   169                              <1> ;		
   170                              <1> ;			类型值		说明
   171                              <1> ;	代码段类型	----------------------------------
   172                              <1> ;			8		只执行 
   173                              <1> ;			9		只执行、已访问 
   174                              <1> ;			A		执行/读 
   175                              <1> ;			B		执行/读、已访问 
   176                              <1> ;			C		只执行、一致码段 
   177                              <1> ;			D		只执行、一致码段、已访问 
   178                              <1> ;			E		执行/读、一致码段 
   179                              <1> ;			F		执行/读、一致码段、已访问 
   180                              <1> ;
   181                              <1> ;		
   182                              <1> ;	系统段类型	类型编码	说明
   183                              <1> ;			----------------------------------
   184                              <1> ;			0		<未定义>
   185                              <1> ;			1		可用286TSS
   186                              <1> ;			2		LDT
   187                              <1> ;			3		忙的286TSS
   188                              <1> ;			4		286调用门
   189                              <1> ;			5		任务门
   190                              <1> ;			6		286中断门
   191                              <1> ;			7		286陷阱门
   192                              <1> ;			8		未定义
   193                              <1> ;			9		可用386TSS
   194                              <1> ;			A		<未定义>
   195                              <1> ;			B		忙的386TSS
   196                              <1> ;			C		386调用门
   197                              <1> ;			D		<未定义>
   198                              <1> ;			E		386中断门
   199                              <1> ;			F		386陷阱门
   200                              <1> ;
   201                              <1> ; (5) G:    段界限粒度(Granularity)位。
   202                              <1> ;		G=0 表示界限粒度为字节；
   203                              <1> ;		G=1 表示界限粒度为4K 字节。
   204                              <1> ;           注意，界限粒度只对段界限有效，对段基地址无效，段基地址总是以字节为单位。 
   205                              <1> ;
   206                              <1> ; (6) D/B:  此位是一个很特殊的位，在描述可执行段、向下扩展数据段或由SS寄存器寻址的段(通常是堆栈段)的三种描述符中的意义各不相同。 
   207                              <1> ;           ⑴ 在描述可执行段的描述符中，D位决定了指令使用的地址及操作数所默认的大小。
   208                              <1> ;		① D=1表示默认情况下指令使用32位地址及32位或8位操作数，这样的代码段也称为32位代码段；
   209                              <1> ;		② D=0 表示默认情况下，使用16位地址及16位或8位操作数，这样的代码段也称为16位代码段，它与80286兼容。可以使用地址大小前缀和操作数大小前缀分别改变默认
   210                              <1> ;           ⑵ 在向下扩展数据段的描述符中，D位决定段的上部边界。
   211                              <1> ;		① D=1表示段的上部界限为4G；
   212                              <1> ;		② D=0表示段的上部界限为64K，这是为了与80286兼容。 
   213                              <1> ;           ⑶ 在描述由SS寄存器寻址的段描述符中，D位决定隐式的堆栈访问指令(如PUSH和POP指令)使用何种堆栈指针寄存器。
   214                              <1> ;		① D=1表示使用32位堆栈指针寄存器ESP；
   215                              <1> ;		② D=0表示使用16位堆栈指针寄存器SP，这与80286兼容。 
   216                              <1> ;
   217                              <1> ; (7) AVL:  软件可利用位。80386对该位的使用未左规定，Intel公司也保证今后开发生产的处理器只要与80386兼容，就不会对该位的使用做任何定义或规定。 
   218                              <1> ;
   219                              <1> 
   220                              <1> 
   221                              <1> ;----------------------------------------------------------------------------
   222                              <1> ; 描述符类型值说明
   223                              <1> ; 其中:
   224                              <1> ;       DA_  : Descriptor Attribute
   225                              <1> ;       D    : 数据段
   226                              <1> ;       C    : 代码段
   227                              <1> ;       S    : 系统段
   228                              <1> ;       R    : 只读
   229                              <1> ;       RW   : 读写
   230                              <1> ;       A    : 已访问
   231                              <1> ;       其它 : 可按照字面意思理解
   232                              <1> ;----------------------------------------------------------------------------
   233                              <1> DA_32		EQU	4000h	; 32 位段
   234                              <1> 
   235                              <1> DA_DPL0		EQU	  00h	; DPL = 0
   236                              <1> DA_DPL1		EQU	  20h	; DPL = 1
   237                              <1> DA_DPL2		EQU	  40h	; DPL = 2
   238                              <1> DA_DPL3		EQU	  60h	; DPL = 3
   239                              <1> ;----------------------------------------------------------------------------
   240                              <1> ; 存储段描述符类型值说明
   241                              <1> ;----------------------------------------------------------------------------
   242                              <1> DA_DR		EQU	90h	; 存在的只读数据段类型值
   243                              <1> DA_DRW		EQU	92h	; 存在的可读写数据段属性值
   244                              <1> DA_DRWA		EQU	93h	; 存在的已访问可读写数据段类型值
   245                              <1> DA_C		EQU	98h	; 存在的只执行代码段属性值
   246                              <1> DA_CR		EQU	9Ah	; 存在的可执行可读代码段属性值
   247                              <1> DA_CCO		EQU	9Ch	; 存在的只执行一致代码段属性值
   248                              <1> DA_CCOR		EQU	9Eh	; 存在的可执行可读一致代码段属性值
   249                              <1> ;----------------------------------------------------------------------------
   250                              <1> ; 系统段描述符类型值说明
   251                              <1> ;----------------------------------------------------------------------------
   252                              <1> DA_LDT		EQU	  82h	; 局部描述符表段类型值
   253                              <1> DA_TaskGate	EQU	  85h	; 任务门类型值
   254                              <1> DA_386TSS	EQU	  89h	; 可用 386 任务状态段类型值
   255                              <1> DA_386CGate	EQU	  8Ch	; 386 调用门类型值
   256                              <1> DA_386IGate	EQU	  8Eh	; 386 中断门类型值
   257                              <1> DA_386TGate	EQU	  8Fh	; 386 陷阱门类型值
   258                              <1> ;----------------------------------------------------------------------------
   259                              <1> 
   260                              <1> 
   261                              <1> ; 选择子图示:
   262                              <1> ;         ┏━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┳━━┓
   263                              <1> ;         ┃ 15 ┃ 14 ┃ 13 ┃ 12 ┃ 11 ┃ 10 ┃ 9  ┃ 8  ┃ 7  ┃ 6  ┃ 5  ┃ 4  ┃ 3  ┃ 2  ┃ 1  ┃ 0  ┃
   264                              <1> ;         ┣━━┻━━┻━━┻━━┻━━┻━━┻━━┻━━┻━━┻━━┻━━┻━━┻━━╋━━╋━━┻━━┫
   265                              <1> ;         ┃                                 描述符索引                                 ┃ TI ┃   RPL    ┃
   266                              <1> ;         ┗━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━┻━━┻━━━━━┛
   267                              <1> ;
   268                              <1> ; RPL(Requested Privilege Level): 请求特权级，用于特权检查。
   269                              <1> ;
   270                              <1> ; TI(Table Indicator): 引用描述符表指示位
   271                              <1> ;	TI=0 指示从全局描述符表GDT中读取描述符；
   272                              <1> ;	TI=1 指示从局部描述符表LDT中读取描述符。
   273                              <1> ;
   274                              <1> 
   275                              <1> ;----------------------------------------------------------------------------
   276                              <1> ; 选择子类型值说明
   277                              <1> ; 其中:
   278                              <1> ;       SA_  : Selector Attribute
   279                              <1> 
   280                              <1> SA_RPL0		EQU	0	; ┓
   281                              <1> SA_RPL1		EQU	1	; ┣ RPL
   282                              <1> SA_RPL2		EQU	2	; ┃
   283                              <1> SA_RPL3		EQU	3	; ┛
   284                              <1> 
   285                              <1> SA_TIG		EQU	0	; ┓TI
   286                              <1> SA_TIL		EQU	4	; ┛
   287                              <1> ;----------------------------------------------------------------------------
   288                              <1> 
   289                              <1> 
   290                              <1> 
   291                              <1> 
   292                              <1> 
   293                              <1> ; 宏 ------------------------------------------------------------------------------------------------------
   294                              <1> ;
   295                              <1> ; 描述符
   296                              <1> ; usage: Descriptor Base, Limit, Attr
   297                              <1> ;        Base:  dd
   298                              <1> ;        Limit: dd (low 20 bits available)
   299                              <1> ;        Attr:  dw (lower 4 bits of higher byte are always 0)
   300                              <1> %macro Descriptor 3
   301                              <1> 	dw	%2 & 0FFFFh				; 段界限 1				(2 字节)
   302                              <1> 	dw	%1 & 0FFFFh				; 段基址 1				(2 字节)
   303                              <1> 	db	(%1 >> 16) & 0FFh			; 段基址 2				(1 字节)
   304                              <1> 	dw	((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)	; 属性 1 + 段界限 2 + 属性 2		(2 字节)
   305                              <1> 	db	(%1 >> 24) & 0FFh			; 段基址 3				(1 字节)
   306                              <1> %endmacro ; 共 8 字节
   307                              <1> ;
   308                              <1> ; 门
   309                              <1> ; usage: Gate Selector, Offset, DCount, Attr
   310                              <1> ;        Selector:  dw
   311                              <1> ;        Offset:    dd
   312                              <1> ;        DCount:    db
   313                              <1> ;        Attr:      db
   314                              <1> %macro Gate 4
   315                              <1> 	dw	(%2 & 0FFFFh)				; 偏移 1				(2 字节)
   316                              <1> 	dw	%1					; 选择子				(2 字节)
   317                              <1> 	dw	(%3 & 1Fh) | ((%4 << 8) & 0FF00h)	; 属性					(2 字节)
   318                              <1> 	dw	((%2 >> 16) & 0FFFFh)			; 偏移 2				(2 字节)
   319                              <1> %endmacro ; 共 8 字节
   320                              <1> ; ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
   321                                  section LOADER_ENTRY
   322                                  start:
   323                                  [BITS	16]
   324                                  
   325                                  ;#################################################################
   326                                  ; 进入保护模式前的初始化工作
   327                                  ;#################################################################
   328                                  
   329                                  	; 初始化段寄存器，此时cs为0x1000， 并且分配0x100的栈空间
   330 00000000 8CC8                    	mov	ax, cs
   331 00000002 8ED8                    	mov	ds, ax
   332 00000004 8EC0                    	mov	es, ax
   333 00000006 8ED0                    	mov	ss, ax
   334 00000008 BC0001                  	mov	sp, 0100h
   335                                  
   336                                  	; ; 初始化 32 位代码段描述符
   337 0000000B 6631C0                  	xor	eax, eax 
   338 0000000E 8CC8                    	mov	ax, cs
   339 00000010 66C1E004                	shl	eax, 4
   340 00000014 6605[59000000]          	add	eax, LABEL_SEG_CODE32
   341 0000001A A3[7800]                	mov	word [LABEL_DESC_CODE32 + 2], ax
   342 0000001D 66C1E810                	shr	eax, 16
   343 00000021 A2[7A00]                	mov	byte [LABEL_DESC_CODE32 + 4], al
   344 00000024 8826[7D00]              	mov	byte [LABEL_DESC_CODE32 + 7], ah
   345                                  
   346                                  	; 为加载 GDTR 作准备, 将0x1000写到
   347 00000028 6631C0                  	xor	eax, eax
   348 0000002B 8CD8                    	mov	ax, ds
   349 0000002D 66C1E004                	shl	eax, 4
   350 00000031 6605[6E000000]          	add	eax, LABEL_GDT		; eax <- gdt 基地址
   351 00000037 66A3[8800]              	mov	dword [GdtPtr + 2], eax	; [GdtPtr + 2] <- gdt 基地址
   352                                  	; 搞清楚了，gdt界限占用两个字节，因此加个2就到基址部分了。
   353                                  
   354                                  	; 加载 GDTR
   355 0000003B 0F0116[8600]            	lgdt	[GdtPtr]
   356                                  
   357                                  	; 关中断
   358 00000040 FA                      	cli
   359                                  
   360                                  	; 打开地址线A20
   361 00000041 E492                    	in	al, 92h
   362 00000043 0C02                    	or	al, 00000010b
   363 00000045 E692                    	out	92h, al
   364                                  
   365                                  	; 准备切换到保护模式
   366 00000047 0F20C0                  	mov	eax, cr0
   367 0000004A 6683C801                	or	eax, 1
   368 0000004E 0F22C0                  	mov	cr0, eax
   369                                  
   370                                  	; 真正进入保护模式
   371                                  	; 此处为16位保护模式，为了保证能够修改32位的eip，必须使用dword
   372 00000051 66EA000000000800        	jmp	dword SelectorCode32:0
   373                                  
   374                                  ;#################################################################
   375                                  ; 进入保护模式后先运行的32位代码
   376                                  ;#################################################################
   377                                  
   378                                  [BITS	32]
   379                                  
   380                                  LABEL_SEG_CODE32:
   381 00000059 66B81000                	mov	ax, SelectorVideo
   382 0000005D 8EE8                    	mov	gs, ax			; 视频段选择子(目的)
   383                                  
   384 0000005F BF7E070000              	mov	edi, (80 * 11 + 79) * 2	; 屏幕第 11 行, 第 79 列。
   385 00000064 B40C                    	mov	ah, 0Ch			; 0000: 黑底    1100: 红字
   386 00000066 B050                    	mov	al, 'P'
   387 00000068 65668907                	mov	[gs:edi], ax
   388 0000006C EBFE                    	jmp $
   389                                  
   390                                  SegCode32Len	equ	$ - LABEL_SEG_CODE32
   391                                  
   392                                  ;##############################################################
   393                                  ; GDT  Table
   394                                  ;##############################################################
   395                                  ;                              段基址,       段界限     , 属性
   396                                  LABEL_GDT:   	   Descriptor       0,               0, 0           ; 空描述符
   397                              <1> LABEL_GDT: 
   398 0000006E 0000                <1>  dw %2 & 0FFFFh
   399 00000070 0000                <1>  dw %1 & 0FFFFh
   400 00000072 00                  <1>  db (%1 >> 16) & 0FFh
   401 00000073 0000                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
   402 00000075 00                  <1>  db (%1 >> 24) & 0FFh
   403                                  LABEL_DESC_CODE32: Descriptor 0,10000h, DA_C + DA_32; 非一致代码段
   404                              <1> LABEL_DESC_CODE32: 
   405 00000076 0000                <1>  dw %2 & 0FFFFh
   406 00000078 0000                <1>  dw %1 & 0FFFFh
   407 0000007A 00                  <1>  db (%1 >> 16) & 0FFh
   408 0000007B 9841                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
   409 0000007D 00                  <1>  db (%1 >> 24) & 0FFh
   410                                  LABEL_DESC_VIDEO:  Descriptor 0B8000h,          0ffffh, DA_DRW	    
   411                              <1> LABEL_DESC_VIDEO: 
   412 0000007E FFFF                <1>  dw %2 & 0FFFFh
   413 00000080 0080                <1>  dw %1 & 0FFFFh
   414 00000082 0B                  <1>  db (%1 >> 16) & 0FFh
   415 00000083 9200                <1>  dw ((%2 >> 8) & 0F00h) | (%3 & 0F0FFh)
   416 00000085 00                  <1>  db (%1 >> 24) & 0FFh
   417                                  ; 显存首地址, 仍然是16位的，因此就不加上DA_32
   418                                  
   419                                  ; GDT 段表信息
   420                                  GdtLen		equ	$ - LABEL_GDT	; GDT长度
   421 00000086 1700                    GdtPtr		dw	GdtLen - 1	; GDT界限
   422 00000088 00000000                			dd  0		; GDT基地址
   423                                  
   424                                  ; GDT 选择子
   425                                  SelectorCode32		equ	LABEL_DESC_CODE32	- LABEL_GDT
   426                                  SelectorVideo		equ	LABEL_DESC_VIDEO	- LABEL_GDT
   427                                  ; END of [SECTION .gdt]
